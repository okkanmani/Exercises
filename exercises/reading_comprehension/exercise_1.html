<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RC Quiz — Science & Nature (5 passages)</title>
  <style>
    :root{
      --bg:#f4f7fb; --card:#ffffff; --accent:#0b66ff; --muted:#6b7280;
      --good:#ecfdf5; --good-text:#064e3b; --bad:#fff1f2; --bad-text:#7f1d1d;
      --explain-bg:#f8fafc; --max-width:1200px;
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:#0b1220;background:var(--bg)}
    .wrap{max-width:var(--max-width);margin:24px auto;padding:18px}
    .card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 8px 24px rgba(12,20,40,0.06)}
    header{display:flex;align-items:baseline;justify-content:space-between;gap:12px;margin-bottom:12px}
    header h1{margin:0;font-size:20px}
    header .muted{color:var(--muted);font-size:13px}
    .layout{display:grid;grid-template-columns:1fr 420px;gap:18px;align-items:start}
    .passagePanel{padding:18px;overflow:auto;height:72vh}
    .questionsPanel{padding:14px;overflow:auto;height:72vh}
    .passTitle{font-size:24px;font-weight:700;margin-bottom:10px}
    .passageText{line-height:1.7;white-space:pre-wrap}
    .question{padding:10px;margin-bottom:12px;border-radius:8px;background:#fbfdff;border:1px solid #eef2ff}
    .qtext{font-weight:600;margin-bottom:8px}
    .muted{color:var(--muted);font-size:13px}
    label.option{display:block;padding:8px;margin:6px 0;border-radius:8px;cursor:pointer;border:1px solid transparent}
    label.option:hover{background:#f7fbff}
    input[type=radio]{margin-right:8px}
    .controls{display:flex;gap:10px;justify-content:flex-end;margin-top:12px}
    button{background:var(--accent);color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;font-weight:600}
    button.secondary{background:#eef2ff;color:var(--accent);font-weight:600}
    button:disabled{opacity:0.5;cursor:default}
    .resultBox{margin-top:12px;padding:12px;border-radius:8px}
    .correct{background:var(--good);color:var(--good-text);padding:8px;border-radius:6px}
    .incorrect{background:var(--bad);color:var(--bad-text);padding:8px;border-radius:6px}
    .review-item{padding:8px;border-radius:8px;margin-bottom:8px;border:1px solid #eef2ff}
    .explanation{background:var(--explain-bg);padding:8px;border-radius:6px;margin-top:8px;font-size:14px}
    .small{font-size:13px;color:var(--muted)}
    footer{margin-top:14px;color:var(--muted);font-size:13px}
    @media (max-width:980px){
      .layout{grid-template-columns:1fr;}.passagePanel{height:45vh}.questionsPanel{height:45vh}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <div>
          <h1>Reading Comprehension — Science & Nature (Challenging)</h1>
          <p><a href="../index.html">Back To Main Page</a></p>
          <div class="muted">5 passages • 6 questions each • 2 vocabulary questions per passage</div>
        </div>
        <div class="muted">Tip: Use <strong>Previous</strong> and <strong>Next</strong>. Submit appears on the last page.</div>
      </header>

      <div id="main" class="layout">
        <div class="passagePanel card">
          <div id="passageHeader" class="passTitle">Passage 1 of 5 — The Water Cycle and Why It Matters</div>
          <div id="passageText" class="passageText"></div>

          <div class="controls" style="justify-content:flex-start;margin-top:16px">
            <button id="prevBtn" class="secondary">Previous</button>
          </div>
        </div>

        <div class="questionsPanel card">
          <div class="muted" id="qHeader">Questions</div>
          <div id="questionsContainer"></div>

          <div class="controls" style="margin-top:12px">
            <button id="nextBtn" class="secondary">Next</button>
            <button id="submitBtn" style="display:none">Submit</button>
          </div>

          <div id="feedback" style="margin-top:12px"></div>
        </div>
      </div>

      <footer class="muted">This quiz runs entirely in your browser. No data leaves your device.</footer>
    </div>
  </div>

<script>
/* shuffle helper */
function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

/* ===== Passages, Questions, Explanations =====
Each passage has: title, text, questions [{q, choices[], a (index), explanation}]
*/
const passages = [
  {
    title: "Magnets and Magnetism",
    text: `Magnets have fascinated humans for thousands of years. A magnet is an object that produces a magnetic field, an invisible force that can attract certain metals like iron, nickel, and cobalt. This force is responsible for many important technologies in our everyday lives, from simple refrigerator magnets to complex machinery.

Magnetism comes from the motion of electric charges. Inside atoms, electrons spin and move, creating tiny magnetic fields. In most materials, these fields point in random directions and cancel each other out, so no magnetism is observed. But in magnetic materials, many atoms’ fields align in the same direction, producing a strong magnetic field.

One of the most common magnets is a bar magnet, which has two poles: a north pole and a south pole. Opposite poles attract each other, while like poles repel. This is why two magnets can either stick together or push apart. The Earth itself acts like a giant magnet with magnetic poles near its geographic north and south, which helps compasses point north and guide travelers.

Magnetism is not just useful for navigation; it plays a vital role in many devices. For example, electric motors use magnets and electricity to create movement, powering everything from household appliances to cars. Hard drives in computers store data magnetically, and MRI machines use strong magnets to see inside the human body.

Scientists continue to explore magnetism, discovering materials called superconductors that can create magnetic fields without resistance, opening the door to futuristic technologies. Understanding magnetism helps us appreciate the hidden forces that shape our modern world.`,
    questions: [
      {
        q: "Word meaning — What does 'magnetic field' most nearly mean in the passage?",
        choices: [
          "An invisible force around a magnet",
          "A field full of iron",
          "A place where magnets grow",
          "A type of electricity"
        ],
        a: 0,
        explanation: "A magnetic field is an unseen force generated by magnets."
      },
      {
        q: "Word meaning — What does 'repel' mean in the context of magnets?",
        choices: [
          "To push away",
          "To pull closer",
          "To stick together",
          "To break apart"
        ],
        a: 0,
        explanation: "'Repel' means to push away, like two north poles of magnets."
      },
      {
        q: "Why do most materials not show magnetism?",
        choices: [
          "Their atoms’ magnetic fields cancel out.",
          "They do not have electrons.",
          "They are too cold.",
          "They are made of plastic."
        ],
        a: 0,
        explanation: "In most materials, atomic magnetic fields point in random directions and cancel each other."
      },
      {
        q: "What can we infer about how compasses work?",
        choices: [
          "They use Earth’s magnetic field to show direction.",
          "They use electricity to move.",
          "They use sunlight to glow.",
          "They work only near magnets."
        ],
        a: 0,
        explanation: "The Earth acts like a giant magnet, so compasses align with its magnetic field."
      },
      {
        q: "Why is magnetism important in technology?",
        choices: [
          "It helps power motors and store data.",
          "It makes magnets glow.",
          "It cools computers.",
          "It creates light."
        ],
        a: 0,
        explanation: "Magnetism enables devices like motors, hard drives, and MRI machines."
      },
      {
        q: "What does the discovery of superconductors mean for the future?",
        choices: [
          "They may lead to new technologies with no resistance.",
          "They will replace all magnets.",
          "They will make magnets weaker.",
          "They have no use."
        ],
        a: 0,
        explanation: "Superconductors can create magnetic fields without resistance, useful for advanced tech."
      }
    ]
  },
  {
    title: "The Life Cycle of a Butterfly",
    text: `Butterflies are some of the most beautiful and fascinating insects. Their life cycle is a perfect example of metamorphosis, which means “change in form.” This process involves four main stages: egg, larva (caterpillar), pupa (chrysalis), and adult butterfly.

It all starts when a female butterfly lays tiny eggs on leaves or stems of plants. These eggs are often so small they are hard to see. After a few days or weeks, a caterpillar hatches from the egg. The caterpillar's main job is to eat and grow. It munches on leaves and sheds its skin several times as it becomes bigger.

Once it is ready, the caterpillar forms a protective case called a chrysalis. Inside this pupa, incredible changes occur. The caterpillar's body breaks down and reorganizes into a butterfly. This stage can last from a week to several months, depending on the species and environment.

Finally, the adult butterfly emerges, dries its wings, and flies away to find food and mates. Butterflies use their long, tube-like tongues called proboscises to sip nectar from flowers. The adults will soon lay eggs, and the cycle begins again.

Understanding the butterfly’s life cycle helps scientists learn about development, environmental changes, and biodiversity. It also inspires many people to appreciate nature's wonders.`,
    questions: [
      {
        q: "Word meaning — What does 'metamorphosis' most nearly mean?",
        choices: [
          "A complete change in form",
          "A type of flower",
          "A butterfly’s wings",
          "A kind of leaf"
        ],
        a: 0,
        explanation: "Metamorphosis means a full transformation in an organism’s shape and form."
      },
      {
        q: "Word meaning — What is a 'chrysalis'?",
        choices: [
          "A protective case for the pupa stage",
          "A type of caterpillar",
          "A flower that butterflies like",
          "A butterfly’s wing"
        ],
        a: 0,
        explanation: "A chrysalis is the protective shell formed during the pupa stage."
      },
      {
        q: "Why does the caterpillar shed its skin?",
        choices: [
          "Because it grows bigger and needs a new skin.",
          "Because it wants to fly.",
          "Because it is cold.",
          "Because it is hungry."
        ],
        a: 0,
        explanation: "Shedding skin allows the caterpillar to grow larger."
      },
      {
        q: "What can we infer happens inside the chrysalis?",
        choices: [
          "The caterpillar’s body changes into a butterfly.",
          "The butterfly lays eggs.",
          "The caterpillar sleeps without change.",
          "The butterfly flies inside."
        ],
        a: 0,
        explanation: "The chrysalis is where the caterpillar transforms into a butterfly."
      },
      {
        q: "Why do adult butterflies use their proboscises?",
        choices: [
          "To drink nectar from flowers.",
          "To catch other insects.",
          "To make sounds.",
          "To build nests."
        ],
        a: 0,
        explanation: "Proboscises help butterflies sip nectar, their main food source."
      },
      {
        q: "What is the significance of studying the butterfly life cycle?",
        choices: [
          "It teaches us about development and nature.",
          "It helps us find flowers.",
          "It tells us how to fly.",
          "It explains how to build homes."
        ],
        a: 0,
        explanation: "Studying this cycle helps understand biology and environmental changes."
      }
    ]
  },
  {
    title: "Bullying and Its Effects",
    text: `Bullying is a serious problem that affects many students around the world. It means repeatedly hurting or upsetting someone, either physically, verbally, or emotionally. Bullying can happen in schools, online, or even at home. It often involves one person or a group targeting someone who seems different or weaker.

Victims of bullying can feel scared, lonely, and sad. It can harm their self-esteem and make it hard to concentrate in school. Sometimes, bullying leads to anxiety, depression, or even physical health problems. Bystanders who watch bullying but do nothing can also feel upset or guilty.

There are many types of bullying. Physical bullying includes hitting, pushing, or damaging someone's belongings. Verbal bullying involves name-calling, teasing, or threatening. Cyberbullying uses technology to spread rumors or mean messages. Each type can be very damaging.

Schools and communities are working hard to stop bullying by teaching kindness, respect, and empathy. Students are encouraged to speak up, support friends, and report bullying safely. Preventing bullying creates a safer environment where everyone can learn and grow without fear.

Understanding bullying’s effects helps everyone take it seriously and work together to stop it.`,
    questions: [
      {
        q: "Word meaning — What does 'victims' mean in this passage?",
        choices: [
          "People who are hurt or targeted by bullying",
          "People who bully others",
          "People who watch movies",
          "People who study animals"
        ],
        a: 0,
        explanation: "Victims are those who suffer harm from bullying."
      },
      {
        q: "Word meaning — What does 'anxiety' most nearly mean?",
        choices: [
          "Feeling worried or nervous",
          "Feeling very happy",
          "Feeling tired",
          "Feeling hungry"
        ],
        a: 0,
        explanation: "Anxiety means feeling nervous or scared about something."
      },
      {
        q: "Why can bullying make it hard to learn?",
        choices: [
          "Because victims feel scared and distracted.",
          "Because classrooms are noisy.",
          "Because teachers do not teach.",
          "Because books are hard to read."
        ],
        a: 0,
        explanation: "Fear and sadness from bullying can reduce concentration."
      },
      {
        q: "What can we infer about the role of bystanders?",
        choices: [
          "They should help stop bullying instead of ignoring it.",
          "They should join in bullying.",
          "They don’t affect bullying.",
          "They cause bullying."
        ],
        a: 0,
        explanation: "Bystanders can make a difference by reporting or stopping bullying."
      },
      {
        q: "Why is cyberbullying especially harmful?",
        choices: [
          "Because it can happen anytime and reach many people.",
          "Because it is always funny.",
          "Because it happens only at school.",
          "Because it helps make friends."
        ],
        a: 0,
        explanation: "Online bullying can be constant and widespread, increasing harm."
      },
      {
        q: "What is the main goal of anti-bullying programs?",
        choices: [
          "To create safe and respectful environments.",
          "To punish students.",
          "To make schools more strict.",
          "To stop homework."
        ],
        a: 0,
        explanation: "Anti-bullying efforts aim to make schools safe and kind places."
      }
    ]
  },
  {
    title: "Refugees and Immigration",
    text: `People become refugees when they are forced to leave their homes because of war, violence, or persecution. Refugees often flee quickly, leaving behind everything they own. Immigration is when people move to a new country by choice, often looking for better opportunities or to be with family.

Refugees face many challenges. They may live in crowded camps with limited food, water, and healthcare. They often experience fear, uncertainty, and loss. Countries that accept refugees provide shelter, legal protection, and support to help them rebuild their lives.

Immigration also shapes societies by bringing diverse cultures, skills, and ideas. Immigrants contribute to their new communities through work, education, and traditions. However, both refugees and immigrants can face difficulties such as discrimination or adjusting to new languages and customs.

International organizations like the United Nations work to protect refugees' rights and encourage fair immigration policies. Learning about refugees and immigration helps us understand global issues and the importance of kindness and fairness.`,
    questions: [
      {
        q: "Word meaning — What does 'persecution' mean in this passage?",
        choices: [
          "Being treated badly because of beliefs or identity",
          "Being given gifts",
          "Getting a new job",
          "Traveling for fun"
        ],
        a: 0,
        explanation: "Persecution means unfair treatment because of who someone is."
      },
      {
        q: "Word meaning — What does 'discrimination' refer to here?",
        choices: [
          "Unfair treatment of people based on differences",
          "Helping someone in need",
          "Learning a new language",
          "Moving to a new country"
        ],
        a: 0,
        explanation: "Discrimination means treating people unfairly because they are different."
      },
      {
        q: "Why do refugees leave their homes?",
        choices: [
          "Because of war, violence, or danger.",
          "Because they want to travel.",
          "Because they are bored.",
          "Because of the weather."
        ],
        a: 0,
        explanation: "Refugees flee due to unsafe or violent conditions."
      },
      {
        q: "What can we infer about the impact of immigrants on society?",
        choices: [
          "They bring new skills and cultures that enrich communities.",
          "They make communities smaller.",
          "They always cause problems.",
          "They do not contribute."
        ],
        a: 0,
        explanation: "Immigrants add value through work, education, and cultural diversity."
      },
      {
        q: "Why might refugees face challenges adjusting to new countries?",
        choices: [
          "Because of language barriers and different customs.",
          "Because they don’t want to work.",
          "Because the weather is always cold.",
          "Because there are no schools."
        ],
        a: 0,
        explanation: "New languages and cultures can make adapting difficult."
      },
      {
        q: "What is the role of organizations like the United Nations?",
        choices: [
          "To protect refugees and promote fair immigration policies.",
          "To stop all immigration.",
          "To build walls.",
          "To send refugees back immediately."
        ],
        a: 0,
        explanation: "These organizations help refugees and encourage just treatment."
      }
    ]
  },
  {
    title: "How Elections Work in Canada",
    text: `Elections are the process by which citizens choose their government leaders. In Canada, elections happen at different levels: federal, provincial, and municipal. During an election, people vote for candidates who want to represent them in government. The candidate with the most votes in a riding (electoral district) wins and becomes a Member of Parliament or a local representative.

Canada uses a system called 'first past the post,' where the candidate with the most votes wins, even if they don’t have more than half the votes. This can sometimes lead to discussions about fairness and representation.

Political parties play an important role in elections. They organize campaigns, share their ideas (called platforms), and try to convince voters to choose them. Leaders of parties may become the Prime Minister or Premier if their party wins the most seats.

Voting is a right and a responsibility. Citizens aged 18 and over can vote in elections. Voting helps people have a say in laws, policies, and how the country is run. Elections are usually held every four years but can happen sooner if the government falls or calls for a new election.

Understanding elections helps citizens participate actively and make informed choices that shape their communities and country.`,
    questions: [
      {
        q: "Word meaning — What does 'candidate' mean in the passage?",
        choices: [
          "A person running for a government position",
          "A voter",
          "A government worker",
          "A person who counts votes"
        ],
        a: 0,
        explanation: "A candidate is someone who wants to be elected."
      },
      {
        q: "Word meaning — What does 'platform' refer to in elections?",
        choices: [
          "A party’s ideas and plans",
          "A physical stage for speeches",
          "A voting booth",
          "A kind of ballot paper"
        ],
        a: 0,
        explanation: "A platform is what a political party promises to do."
      },
      {
        q: "Why does the 'first past the post' system sometimes cause debate?",
        choices: [
          "Because the winner may not have over half the votes.",
          "Because voting takes too long.",
          "Because it uses paper ballots.",
          "Because only one party participates."
        ],
        a: 0,
        explanation: "The system can elect candidates without majority support."
      },
      {
        q: "What can we infer about the importance of voting?",
        choices: [
          "It lets citizens influence laws and leadership.",
          "It is optional and unimportant.",
          "It always chooses the Prime Minister directly.",
          "It only happens in big cities."
        ],
        a: 0,
        explanation: "Voting is key for democratic participation and decision-making."
      },
      {
        q: "Why might elections be held before four years?",
        choices: [
          "If the government loses support or calls for one.",
          "If it rains a lot.",
          "If the Prime Minister travels.",
          "If citizens don’t vote."
        ],
        a: 0,
        explanation: "Early elections occur if the government falls or chooses to have one."
      },
      {
        q: "What is the main purpose of political parties in elections?",
        choices: [
          "To organize campaigns and share ideas.",
          "To count votes.",
          "To stop people from voting.",
          "To make laws directly."
        ],
        a: 0,
        explanation: "Parties run candidates and promote policies to voters."
      }
    ]
  }
];


/* ===== State & UI elements ===== */
let page = 0;
const totalPages = passages.length;
const answers = {}; // store selected original index per question, e.g., 'p0q1': 2

const passageHeader = document.getElementById('passageHeader');
const passageText = document.getElementById('passageText');
const qsContainer = document.getElementById('questionsContainer');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const submitBtn = document.getElementById('submitBtn');
const feedback = document.getElementById('feedback');
const qHeader = document.getElementById('qHeader');

const renderedQuestionNodes = {}; // track rendered nodes for inserting explanations

/* Render page */
function renderPage(idx) {
  const p = passages[idx];
  passageHeader.textContent = `Passage ${idx+1} of ${totalPages} — ${p.title}`;
  passageText.textContent = p.text;
  qsContainer.innerHTML = '';
  qHeader.textContent = `Questions — Passage ${idx+1}`;
  // clear rendered map
  for (const k in renderedQuestionNodes) delete renderedQuestionNodes[k];

  p.questions.forEach((q, qi) => {
    const qKey = `p${idx}q${qi}`;
    const qDiv = document.createElement('div');
    qDiv.className = 'question';
    qDiv.id = qKey;

    const qTitle = document.createElement('div');
    qTitle.className = 'qtext';
    qTitle.textContent = `Q${qi+1}. ${q.q}`;
    qDiv.appendChild(qTitle);

    // Shuffle display order but keep original indices
    const choiceObjs = q.choices.map((c, i) => ({ text: c, origIndex: i }));
    shuffle(choiceObjs);

    const labels = [];
    choiceObjs.forEach((ch, ci) => {
      const id = `${qKey}c${ci}`;
      const label = document.createElement('label');
      label.className = 'option';
      label.htmlFor = id;
      const radio = document.createElement('input');
      radio.type = 'radio';
      radio.name = qKey;
      radio.id = id;
      radio.value = ch.origIndex; // store original index for grading

      if (answers[qKey] !== undefined && answers[qKey] === ch.origIndex) {
        radio.checked = true;
      }

      radio.addEventListener('change', () => {
        answers[qKey] = Number(radio.value);
      });

      label.appendChild(radio);
      label.appendChild(document.createTextNode(ch.text));
      qDiv.appendChild(label);
      labels.push(label);
    });

    qsContainer.appendChild(qDiv);
    renderedQuestionNodes[qKey] = { container: qDiv, labels: labels, questionObj: q };
  });

  prevBtn.disabled = idx === 0;
  nextBtn.disabled = idx === totalPages - 1;
  submitBtn.style.display = (idx === totalPages - 1) ? 'inline-block' : 'none';
  feedback.innerHTML = '';
}

/* Grading and explanations insertion */
function gradeAllAndShow() {
  let total = 0, score = 0;
  const fullReview = document.createElement('div');

  passages.forEach((p, pi) => {
    const passBlock = document.createElement('div');
    passBlock.style.marginBottom = '12px';
    const passTitle = document.createElement('div');
    passTitle.style.fontWeight = '700';
    passTitle.textContent = `Passage ${pi+1}: ${p.title}`;
    passBlock.appendChild(passTitle);

    p.questions.forEach((q, qi) => {
      total++;
      const key = `p${pi}q${qi}`;
      const chosen = answers[key] !== undefined ? Number(answers[key]) : null;
      const isCorrect = chosen === q.a;
      if (isCorrect) score++;

      // If this question is currently visible, insert explanation directly under it
      const rendered = renderedQuestionNodes[key];
      if (rendered && rendered.container) {
        const oldExpl = rendered.container.querySelector('.explanation');
        if (oldExpl) oldExpl.remove();

        const expl = document.createElement('div');
        expl.className = 'explanation';

        const status = document.createElement('div');
        status.style.fontWeight = '700';
        status.style.marginBottom = '6px';
        if (isCorrect) {
          status.textContent = `✅ Correct — You chose: ${chosen === null ? 'Unanswered' : q.choices[chosen]}`;
          status.style.color = 'var(--good-text)';
        } else {
          status.textContent = `❌ ${chosen === null ? 'Unanswered' : 'Incorrect'} — Your answer: ${chosen === null ? 'Unanswered' : q.choices[chosen]}; Correct: ${q.choices[q.a]}`;
          status.style.color = 'var(--bad-text)';
        }
        expl.appendChild(status);

        const expt = document.createElement('div');
        expt.textContent = q.explanation || '';
        expl.appendChild(expt);

        rendered.container.appendChild(expl);

        // highlight labels
        rendered.labels.forEach(lbl => {
          const inp = lbl.querySelector('input[type=radio]');
          if (!inp) return;
          const val = Number(inp.value);
          if (val === q.a) {
            lbl.style.border = '1px solid #bfe6c8';
            lbl.style.background = '#f0fff4';
          }
          if (chosen !== null && val === chosen && chosen !== q.a) {
            lbl.style.border = '1px solid #ffd6d6';
            lbl.style.background = '#fff6f6';
          }
        });
      }

      // Build full-review item
      const item = document.createElement('div');
      item.className = 'review-item';
      const qn = document.createElement('div');
      qn.className = 'qtext';
      qn.textContent = `Passage ${pi+1} — Q${qi+1}. ${q.q}`;
      item.appendChild(qn);

      const your = document.createElement('div');
      your.style.marginTop = '6px';
      your.textContent = `Your answer: ${chosen === null ? 'Unanswered' : q.choices[chosen]}`;
      item.appendChild(your);

      const correctDiv = document.createElement('div');
      correctDiv.style.marginTop = '6px';
      correctDiv.textContent = `Correct answer: ${q.choices[q.a]}`;
      item.appendChild(correctDiv);

      const explanDiv = document.createElement('div');
      explanDiv.style.marginTop = '6px';
      explanDiv.textContent = q.explanation || '';
      item.appendChild(explanDiv);

      passBlock.appendChild(item);
    });

    fullReview.appendChild(passBlock);
  });

  feedback.innerHTML = '';
  const scoreBox = document.createElement('div');
  scoreBox.className = 'resultBox';
  scoreBox.innerHTML = `<div style="font-weight:700">Score: ${score} / ${total}</div><div class="small" style="margin-top:6px">Explanations appear beneath visible questions; full review follows.</div>`;
  feedback.appendChild(scoreBox);
  feedback.appendChild(fullReview);

  disableAllInputs();
  feedback.scrollIntoView({ behavior: 'smooth' });
}

/* disable inputs and nav */
function disableAllInputs() {
  const radios = document.querySelectorAll('input[type=radio]');
  radios.forEach(r => r.disabled = true);
  prevBtn.disabled = true;
  nextBtn.disabled = true;
  submitBtn.disabled = true;
}

/* Events */
prevBtn.addEventListener('click', () => {
  if (page > 0) {
    page--;
    renderPage(page);
  }
});
nextBtn.addEventListener('click', () => {
  if (page < totalPages - 1) {
    page++;
    renderPage(page);
  }
});
submitBtn.addEventListener('click', () => {
  if (!confirm("Submit answers and view explanations? You won't be able to change answers afterward.")) return;
  gradeAllAndShow();
});

/* Init */
renderPage(page);

</script>
</body>
</html>